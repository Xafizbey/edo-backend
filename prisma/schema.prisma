generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  APPROVER
  ADMIN
}

enum DocumentType {
  LEAVE_REQUEST
  BUSINESS_TRIP
  PURCHASE_REQUEST
}

enum DocumentStatus {
  DRAFT
  SUBMITTED
  IN_REVIEW
  CHANGES_REQUESTED
  APPROVED
  REJECTED
  ARCHIVED
}

enum DecisionStatus {
  PENDING
  APPROVED
  REJECTED
  CHANGES_REQUESTED
}

model User {
  id               String         @id @default(cuid())
  fullName         String
  email            String         @unique
  passwordHash     String
  role             Role           @default(USER)
  department       String
  createdAt        DateTime       @default(now())
  documents        Document[]
  approvalSteps    ApprovalStep[] @relation("ApproverSteps")
  auditLogs        AuditLog[]
}

model Document {
  id            String         @id @default(cuid())
  type          DocumentType
  title         String
  bodyJson      Json
  authorId      String
  author        User           @relation(fields: [authorId], references: [id])
  status        DocumentStatus @default(DRAFT)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  currentStep   Int            @default(0)
  approvalSteps ApprovalStep[]
  auditLogs     AuditLog[]
}

model ApprovalStep {
  id             String         @id @default(cuid())
  documentId     String
  document       Document       @relation(fields: [documentId], references: [id])
  order          Int
  approverId     String
  approver       User           @relation("ApproverSteps", fields: [approverId], references: [id])
  decisionStatus DecisionStatus @default(PENDING)
  comment        String?
  decidedAt      DateTime?

  @@unique([documentId, order])
}

model AuditLog {
  id         String   @id @default(cuid())
  documentId String
  document   Document @relation(fields: [documentId], references: [id])
  actorId    String
  actor      User     @relation(fields: [actorId], references: [id])
  actionType String
  metaJson   Json?
  createdAt  DateTime @default(now())
}
